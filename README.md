# 🛠️ GitLab CI/CD Variable Manager

A Python script for **centralized management of CI/CD variables** across GitLab projects. It allows you to **export**, **search**, **add**, or **update** variables from Excel/CSV files, making the management of large GitLab environments simple and scalable.

---

## ✨ Features

* 🔍 **search**: search for a variable across all GitLab projects (even if missing) and save the results in a `.xlsx` file.
* 📤 **read**: export **all** CI/CD variables from **all GitLab projects** into an Excel and CSV file.
* ➕ **write**: read a `.xlsx` file and **create** any missing variables in the corresponding projects.
* 🔄 **update**: read a `.xlsx` file and **update** existing variables if the values differ.

---

## 🥪 Requirements

* Python 3.7+

* Python libraries:

  ```bash
  pip install python-gitlab pandas openpyxl
  ```

* Environment variables (optional but recommended):

  ```bash
  export GITLAB_URL="https://gitlab.example.com/"
  export PRIVATE_TOKEN="..."
  ```

---

## ⚙️ Usage

```bash
python gitlab-varsync.py <command> [argument] [-f FILE]
```

### Available Commands:

| Command  | Description                                                                                           |
| -------- | ----------------------------------------------------------------------------------------------------- |
| `read`   | Exports all CI/CD variables from all GitLab projects into `gitlab_variables_all_groups.xlsx`.         |
| `write`  | Creates only the **missing** variables from a `.xlsx` file.                                           |
| `update` | Updates existing variables if the values differ.                                                      |
| `search` | Searches for a specific key (`key`) across projects and saves the results in a `.xlsx` file.          |

---

## 📁 Usage Examples

### 1. Export all CI/CD variables:

```bash
python gitlab-varsync.py read
```

### 2. Search for a variable (e.g., `SONAR_TOKEN`) across all projects:

```bash
python gitlab-varsync.py search SONAR_TOKEN
```

### 3. Create missing variables from a file generated by `search`:

```bash
python gitlab-varsync.py write -f SONAR_TOKEN.xlsx
```

### 4. Update existing variables:

```bash
python gitlab-varsync.py update
```

### 5. Apply a project filter (e.g., only projects containing "starter"):

```bash
python gitlab-varsync.py read starter
python gitlab-varsync.py write starter -f SONAR_TOKEN.xlsx
```

---

## ⚠️ Handled Corner Cases

* 🔶 **Invalid values** (`NaN`, `inf`, empty cells):

  * Ignored with a clear warning:  
    `⚠️ Warning: undefined value for 'KEY' in ProjectName – variable skipped.`

* 🚩 **Invalid token** or **non-existent project**:

  * Displays an error:  
    `❌ Project not found: ID 123456`

* ⟲ **Variable already exists**:

  * Skipped during `write`, or updated in `update`.

* 🔐 **Changed environment scope**:

  * The variable is deleted and recreated with the new scope.

---

## 📆 Output/Input Files

* `gitlab_variables_all_groups.xlsx`: generated by `read`, contains all CI/CD variables.
* `<KEY>.xlsx`: generated by `search`, contains only the searched variable.
* Both files can be manually edited and reused with `write` or `update`.

---

## 📦 Possible Future Extensions

* Support for group-level pipelines.
* Global management of protected/masked variables.
* Web or TUI interface for visual interaction.

---

## 📄 License

MIT License – feel free to use, modify, and contribute!
